(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self,e.OmniCookies=t())})(this,function(){'use strict';var _MathE=Math.E,_Mathsin=Math.sin,_Mathabs=Math.abs,_MathPI=Math.PI,_Mathmax=Math.max,_Mathfloor=Math.floor,_Mathpow=Math.pow,_Mathmin=Math.min;function log(e){console.log("[Omniscient Cookies] "+e)}function warn(e){console.warn("[Omniscient Cookies] "+e)}function error(e){console.error("[Omniscient Cookies] "+e)}function replaceCode(targetFunction,listReplacements,preEvalScript){var code=targetFunction.toString(),newCode=code;for(var i in listReplacements){var patt=listReplacements[i].pattern,repl=listReplacements[i].replacement;("string"!=typeof patt||newCode.includes(patt))&&("object"!=typeof patt||newCode.match(patt))||warn("Replacement pattern '"+patt+"' not found"),newCode=newCode.replace(patt,repl)}var func;return eval((preEvalScript?preEvalScript:"")+"func = "+newCode),func}function calcMaxBuyBulk(e,t){var a=0,s=0,i=0;return(-1==t&&(t=1/0),Game.cookies==1/0&&t==1/0)?{totalPrice:1/0,maxPrice:1/0,maxAmount:t}:(a=quickCalcBulkPrice(e,t),i=_Mathmin(t,quickCalcMaxBuy(e)+e.free),s=quickCalcBulkPrice(e,i),{totalPrice:a,maxPrice:s,maxAmount:i})}function quickCalcMaxBuy(e){var t=Math.log,a=Game.cookies;a/=Game.modifyBuildingPrice(e.name,e.basePrice);var s=e.amount-e.free,i=Game.priceIncrease;return _Mathfloor(t(_Mathpow(i,s)+(i-1)*a)/t(i)-e.amount)}function quickCalcBulkPrice(e,t,a){var i,s=Math.ceil,n=_Mathmax(0,e.amount-e.free);if(a){if(0>=n)return 0;n--,i=powerSumRange(Game.priceIncrease,_Mathmax(0,n-t),n)}else i=powerSumRange(Game.priceIncrease,n,n+t-1);return i=Game.modifyBuildingPrice(e.name,i*e.basePrice),a&&(i*=e.getSellMultiplier()),s(i)}function powerSumRange(e,t,a){if(0>e)return-1;if(0==e)return 0;if(1==e)return a-t;if(t==a)return _Mathpow(e,t);var s=(_Mathpow(e,t)-1)/(e-1),i=(_Mathpow(e,a+1)-1)/(e-1);return i-s}function cycliusCalc(e,t){var a=Date.now()/1e3/(3600*e);return t&&(a+=(new Date().getTimezoneOffset()+60)/60/e),a%=1,2*(a*_MathPI)}function loadData(e,t){if(e)for(var a,s=0,i=Object.keys(e);s<i.length;s++)a=i[s],a in t&&("boolean"==typeof e[a]&&"number"==typeof t[a]&&(e[a]=e[a]?0:2),t[a]=e[a])}function switchMilkIcon(e){var t=Game.Upgrades["Milk selector"];t.icon=0==e?Game.Milk.icon:t.choicesFunction()[e].icon,Game.upgradesToRebuild=1}function getNumSynergyGrandmas(e){return e.grandma&&e.grandma.bought?_Mathfloor(Game.Objects.Grandma.amount/(e.id-1)):-1}function gainInstantPassiveCpS(e){for(var t,a=Game.cookiesPs*e,s=0,i=Game.wrinklers;s<i.length;s++)t=i[s],2==t.phase&&(t.sucked+=a*Game.cpsSucked,Game.cookiesSucked+=a*Game.cpsSucked);a*=1-Game.cpsSucked;for(var n,r=0,o=Game.ObjectsById;r<o.length;r++)n=o[r],n.totalCookies+=n.storedTotalCps*Game.globalCpsMult*e;Game.Earn(a)}function scrollbarStyle(e){var t=document.getElementById("centerArea");t.style.overflowY=e}function onMinigameLoaded(e,t){var a=setInterval(function(){Game.Objects[e].minigameLoaded&&(t(),clearInterval(a))},250)}function loadCustomAsset(e){Game.Loader.assetsLoading[e]||Game.Loader.assetsLoaded[e]||(Game.Loader.assets[e]={},Game.Loader.Replace(e,e),Game.Loader.assetsLoading.push(e))}function holdingButton(e){return Game.keys[e]==null?0:Game.keys[e]}function __extends(e,t){function a(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}function customOptionsMenu(){if("prefs"==Game.onMenu){var e=menuDisplay.display();l("menu").childNodes[2].insertBefore(e,l("menu").childNodes[2].childNodes[l("menu").childNodes[2].childNodes.length-1])}}function registerSupport(e){grandmaProperties[e.building.name]&&warn("Replacing custom grandma support for '"+e.building.name+"'!"),grandmaProperties[e.building.name]=e}function grandmaAmountCalc(e,t){var a=_Mathabs((e-1)/t%1),s=e/t;return _Mathfloor(s-a)<s&&(s+=1),_Mathfloor(s)}function tryDrawGrandmas(e,t,a){var s=grandmaProperties[e.name];if(s){var n=!s.frequency||0>=s.frequency?1:s.frequency,r=getNumSynergyGrandmas(e),o=grandmaAmountCalc(a,n),c=grandmaAmountCalc(a-1,n),d=o-c;2<=o-c&&o--,d=_Mathfloor(_Mathmax(0,_Mathmin(d,r-o)));for(var m=[],u=0;u<d;u++)a+=.1,m=m.concat(s.drawGrandma(t,a));return m}}var ButtonType,name="Omniscient Cookies",version="v2.0.0",vars={lastMilk:-1,lastAutoMilk:void 0,buffsById:[],cursedPs:0,cursedPsMult:0,ascendMeterLevel:void 0,ascendMeterPercent:void 0,levelDiff:0,patchedTrueCyclius:!1,prevShortcut:0},_Logger=Object.freeze({__proto__:null,log:log,warn:warn,error:error});(function(e){e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL"})(ButtonType||(ButtonType={}));var BypassFancySetting,_Util=Object.freeze({__proto__:null,get ButtonType(){return ButtonType},replaceCode:replaceCode,calcMaxBuyBulk:calcMaxBuyBulk,quickCalcMaxBuy:quickCalcMaxBuy,quickCalcBulkPrice:quickCalcBulkPrice,powerSumRange:powerSumRange,cycliusCalc:cycliusCalc,loadData:loadData,switchMilkIcon:switchMilkIcon,getNumSynergyGrandmas:getNumSynergyGrandmas,gainInstantPassiveCpS:gainInstantPassiveCpS,scrollbarStyle:scrollbarStyle,onMinigameLoaded:onMinigameLoaded,loadCustomAsset:loadCustomAsset,holdingButton:holdingButton});(function(e){e[e.Default=0]="Default",e[e.Fast=1]="Fast",e[e.Fancy=2]="Fancy"})(BypassFancySetting||(BypassFancySetting={}));var Settings=function(){function e(){this.version=version,this.autoScrollbar=!0,this.scrollingBuildings=!0,this.smoothBuildings=!0,this.buffTooltipDuration=!0,this.betterBuildingTooltips=!0,this.betterGrandmas=!0,this.separateTechs=!0,this.enhancedBulk=!0,this.buildingsBypassFancy=BypassFancySetting.Default,this.cursorsBypassFancy=BypassFancySetting.Default,this.wrinklersBypassFancy=BypassFancySetting.Default,this.optimizeBuildings=!1,this.preserveWrinklers=!1,this.detailedCyclius=!0,this.zonedCyclius=!1,this.trueCyclius=!1,this.stockValueData=!0,this.dangerousStocks=!1,this.tooltipWobble=!1,this.fancyMilkSelect=!0,this.improveMagicMeter=!0,this.skruuiaRebalance=!1,this.improveAscendMeter=!0,this.displaySeasons=!0,this.separateSeasons=!1,this.bringGrandmaToWork=!0,this.cursedFinger=!1,this.optiCookies=!1,this.dangerousBrokers=!1}return e.prototype.set=function(e,t){typeof t==typeof this[e]&&(this[e]=t)},e.prototype.get=function(e){return this[e]},e.prototype.save=function(){return this},e.prototype.load=function(e){e.version&&loadData(e,this)},e}(),settings=new Settings,SaveData=function(){function e(){this.version=version,this.stockAverages=[],this.frozenWrinks=null}return e.prototype.save=function(){return this.cryosleepWrinklers(),this},e.prototype.load=function(e){loadData(e,this),this.thawWrinklers()},e.prototype.reset=function(){this.stockAverages=[],this.frozenWrinks=null},e.prototype.cryosleepWrinklers=function(){this.frozenWrinks=settings.preserveWrinklers?Game.wrinklers:null},e.prototype.thawWrinklers=function(){if(settings.preserveWrinklers&&this.frozenWrinks){var e=Game.wrinklers,t=Game.SaveWrinklers();Game.wrinklers=this.frozenWrinks;var a=Game.SaveWrinklers();if(t.number!=a.number||t.shinies!=a.shinies)return;for(var s,i=0,n=Game.wrinklers;i<n.length;i++)s=n[i],2==s.phase&&(s.sucked+=Game.cookiesPs/Game.fps*Game.cpsSucked*Game.loopT);a=Game.SaveWrinklers();var r=0==t.amount||0==a.amount?t.amount==a.amount?1:0:_Mathmin(t.amount/a.amount,a.amount/t.amount),o=0==t.amountShinies||0==a.amountShinies?t.amountShinies==a.amountShinies?1:0:_Mathmin(t.amountShinies/a.amountShinies,a.amountShinies/t.amountShinies),c=.99;if(r<c||o<c)return void(Game.wrinklers=e)}},e}(),saveData=new SaveData,extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},extendStatics(e,t)},Patch=function(){function e(e,t){this.patchFunc=e,this.removeFunc=t,this.applied=!1}return e.prototype.apply=function(){this.applied||(this.patchFunc(),this.applied=!0)},e.prototype.remove=function(){this.applied&&this.removeFunc&&(this.removeFunc(),this.applied=!1)},e.prototype.toggle=function(e){var t=!this.applied;"undefined"!=typeof e&&(t=e),t?this.apply():this.remove()},e}(),scrollbarStyle$1=new Patch(function(){return scrollbarStyle("auto")},function(){return scrollbarStyle("scroll")}),updateMenu=new Patch(function(){Game.UpdateMenu=replaceCode(Game.UpdateMenu,[{pattern:/}$/,replacement:"OmniCookies.Config.customOptionsMenu();$&"}])}),smoothBuildings=new Patch(function(){Game.DrawBuildings=replaceCode(Game.DrawBuildings,[{pattern:"Game.drawT%3==0",replacement:"OmniCookies.settings.smoothBuildings || $&"}])}),scrollingBuildings=new Patch(function(){var e=[{pattern:"if (this.toResize)",replacement:"if (this.toResize || this.canvas.width != this.canvas.clientWidth || this.canvas.height != this.canvas.clientHeight)"},{pattern:"this.toResize=false;",replacement:"$&;this.forceDraw=true;"},{pattern:"if (typeof(bg)=='string') ctx.fillPattern",replacement:"\n\t\t\t\tlet synergyAmount = OmniCookies.settings.bringGrandmaToWork ? OmniCookies.Util.getNumSynergyGrandmas(this) : -1;\n\t\t\t\tif(OmniCookies.settings.optimizeBuildings && !this.hasUnloadedImages && !this.forceDraw && !this.lastMouseOn && !this.mouseOn && (this.lastAmount == this.amount) && (this.name == 'Grandma' ? true : this.lastSynergyAmount == synergyAmount)) return;\n\t\t\t\tthis.forceDraw = false;\n\t\t\t\tthis.lastAmount = this.amount;\n\t\t\t\tthis.lastMouseOn = this.mouseOn;\n\t\t\t\tthis.lastSynergyAmount = synergyAmount;\n\t\t\t\tthis.hasUnloadedImages = Game.Loader.assetsLoaded.indexOf(this.art.bg) == -1;\n\t\t\t\tlet hasGrandmas = false;\n\t\t\t\t$&"},{pattern:"var sprite=Pic(pic.pic);",replacement:"$&\nthis.hasUnloadedImages = this.hasUnloadedImages || sprite == Game.Loader.blank;"},{pattern:"0,0,this.canvas.width,this.canvas.height,128,128",replacement:"$&,-this.scrollOffX"},{pattern:"var maxI=Math.floor(this.canvas.width",replacement:"var minI=Math.max(0, Math.floor((-50 + this.scrollOffX) / (w/rows)));\nvar maxI=Math.floor((this.canvas.width + 50 + this.scrollOffX)"},{pattern:"var i=this.pics.length;",replacement:"this.pics = [];\nvar i=minI;"},{pattern:"var usedPic=(typeof(pic)=='string'?pic:pic(this,i));",replacement:"x-=this.scrollOffX;\n$&"},{pattern:"var selected=-1;",replacement:"\n\t\t\t\tvar speed = 20;\n\t\t\t\tif(!OmniCookies.settings.smoothBuildings) speed *= 3;\n\t\t\t\tif(this.mousePos[0] >= (this.canvas.width) - 100 && maxI <= this.amount + rows * 3) {\n\t\t\t\t\tthis.scrollOffX += Math.floor(speed * ((this.mousePos[0] - (this.canvas.width - 100)) / 100));\n\t\t\t\t}\n\t\t\t\tif(this.mousePos[0] <= 100 && this.scrollOffX > 0) {\n\t\t\t\t\tthis.scrollOffX -= Math.floor(speed * (1 - this.mousePos[0] / 100));\n\t\t\t\t}\n\t\t\t\tif(this.scrollOffX < 0 || !OmniCookies.settings.scrollingBuildings) this.scrollOffX = 0;\n\t\t\t\t$&"},{pattern:"ctx.drawImage(sprite,Math.floor(pic.x+Math.random()*4-2),Math.floor(pic.y+Math.random()*4-2));",replacement:"\n\t\t\t\tif(Game.drawT%3==0) {\n\t\t\t\t\tthis.lastRandX = Math.random()*4;\n\t\t\t\t\tthis.lastRandY = Math.random()*4;\n\t\t\t\t}\n\t\t\t\tctx.drawImage(sprite,Math.floor(pic.x+this.lastRandX-2),Math.floor(pic.y+this.lastRandY-2));"},{pattern:"this.pics.push({x:Math.floor(x),y:Math.floor(y),z:y,pic:usedPic,id:i,frame:frame});",replacement:"$&\n\t\t\t\tif(OmniCookies.settings.bringGrandmaToWork) {\n\t\t\t\t\tlet grandmas = OmniCookies.GrandmaSupport.tryDrawGrandmas(this, this.pics[this.pics.length-1], i);\n\t\t\t\t\tif(grandmas && grandmas.length > 0){\n\t\t\t\t\t\thasGrandmas = true;\n\t\t\t\t\t\tthis.pics = this.pics.concat(grandmas);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t"},{pattern:"if (this.name=='Grandma')",replacement:"if (this.name=='Grandma' || (OmniCookies.settings.bringGrandmaToWork && hasGrandmas))"},{pattern:"if (selected==i && this.name=='Grandma')",replacement:"if (selected==i && (this.name=='Grandma' || (OmniCookies.settings.bringGrandmaToWork && pic.grandma)))"},{pattern:"if (this.mousePos[0]>=pic.x-marginW && this.m",replacement:"\n\t\t\t\tif(this.name == 'Grandma' ? false : !pic.grandma) continue;\n\t\t\t$&"},{pattern:"Math.seedrandom(Game.seed+' '+pic.id/*+' '+pic.id*/);",replacement:"Math.seedrandom(Game.seed+' '+pic.id+(this.name == 'Grandma' ? '' : ' '+this.name));"}],t=[{pattern:"this.muted=val;",replacement:"$&\nthis.forceDraw=true;"}],a=[{pattern:"me.pics=[];",replacement:"$&\n\t\t\t\tif(OmniCookies.settings.optimizeBuildings) {\n\t\t\t\t\tme.forceDraw = true;\n\t\t\t\t}\n\t\t\t"}];for(var s in Game.Objects){var i=Game.Objects[s];0!=i.id&&(i.scrollOffX=0,i.lastRandX=0,i.lastRandY=0,i.lastOffX=0,i.lastMouseOn=i.mouseOn,i.lastAmount=i.amount,i.lastSynergyAmount=0,i.hasUnloadedImages=!0,i.forceDraw=!0,i.draw=replaceCode(i.draw,e),i.mute=replaceCode(i.mute,t),i.redraw=replaceCode(i.redraw,a))}Game.Object=replaceCode(Game.Object,e),Game.Object=replaceCode(Game.Object,[{pattern:"//building canvas",replacement:"\n\t\t\t\tthis.scrollOffX = 0;\n\t\t\t\tthis.lastRandX = 0;\n\t\t\t\tthis.lastRandY = 0;\n\t\t\t\tthis.lastOffX = 0;\n\t\t\t\tthis.lastMouseOn = this.mouseOn;\n\t\t\t\tthis.lastAmount = this.amount;\n\t\t\t\tthis.lastSynergyAmount = 0;\n\t\t\t\tthis.hasUnloadedImages = true;\n\t\t\t\tthis.forceDraw = true;\n\t\t\t$&"}]),Game.Object=replaceCode(Game.Object,t),Game.Object=replaceCode(Game.Object,a),Game.Objects.Grandma.art.pic=replaceCode(Game.Objects.Grandma.art.pic,[{pattern:"if (Game.Has('Far",replacement:"if(!OmniCookies.settings.bringGrandmaToWork) {\n\t\t\t$&"},{pattern:"metaGrandma');",replacement:"$&\n\t\t\t}"},{pattern:"if (Game.Has('Alternate grandmas')) list.push('alternateGrandma');",replacement:"if(!OmniCookies.settings.bringGrandmaToWork) $&"}])}),buildingTooltips=new Patch(function(){var e=[{pattern:"if (synergiesStr!='') synergiesStr+=', ';",replacement:"if (OmniCookies.settings.betterBuildingTooltips || synergiesStr != '')\n\t\t\t\tsynergiesStr += OmniCookies.settings.betterBuildingTooltips \n\t\t\t\t\t? '<br>&nbsp;&nbsp;&nbsp;&nbsp;- '\n\t\t\t\t\t: ', ';"},{pattern:"synergiesStr+=i+' +'+Beautify(synergiesWith[i]*100,1)+'%';",replacement:"synergiesStr+=i+' '+\n\t\t\t(OmniCookies.settings.betterBuildingTooltips ? '<b>' : '')+\n\t\t\t'+'+Beautify(synergiesWith[i]*100,1)+'%'+\n\t\t\t(OmniCookies.settings.betterBuildingTooltips ? '</b>' : '');"},{pattern:"synergiesStr='...also boosting some other buildings : '+synergiesStr+' - all",replacement:"synergiesStr='...also boosting some other buildings'+\n\t\t\t(OmniCookies.settings.betterBuildingTooltips \n\t\t\t\t? ': '+synergiesStr+'<br>&bull; ' \n\t\t\t\t: ' : '+synergiesStr+' - ')+'all"},{pattern:"<div class=\"data\"",replacement:"$& '+(OmniCookies.settings.betterBuildingTooltips ? 'style=\"white-space:nowrap;\"' : '')+'"}];for(var t in Game.Objects){var a=Game.Objects[t];a.tooltip=replaceCode(a.tooltip,e)}Game.Object=replaceCode(Game.Object,e)}),buffTooltips=new Patch(function(){vars.buffsById=[];var e=function(e){var t=Game.buffs[e];vars.buffsById[t.id]=t;var a=function(){Game.mouseDown||(Game.setOnCrate(this),Game.tooltip.dynamic=1,Game.tooltip.draw(this,function(){return vars.GetBuffTooltipFunc(t.id)()},"left"),Game.tooltip.wobble())};a=a.toString().replace("function() {","").replace(/}$/,"").replace("buff.id",t.id),Game.buffsL.getElementsByClassName("crate enabled buff")[t.id].setAttribute("onmouseover",a)};for(var t in Game.buffs)e(t);Game.gainBuff=replaceCode(Game.gainBuff,[{pattern:"Game.buffsL.",replacement:"OmniCookies.vars.buffsById[buff.id] = buff;$&"},{pattern:"//new duration is set to new",replacement:"$&\n\t\t\t\tvar tempBuff=type.func(buff.time/Game.fps,arg1,arg2,arg3);\n\t\t\t\tbuff.desc = tempBuff.desc;\n\t\t\t"},{pattern:Game.gainBuff.toString().substr(1037,202),replacement:"Game.getDynamicTooltip('(OmniCookies.vars.GetBuffTooltipFunc('+buff.id+'))', 'left', true)"}]);var a=document.createElement("div");a.className="prompt";var s=document.createElement("h3");a.id="OmniCookies_width_test",a.appendChild(s),a.style.visibility="hidden",document.getElementById("game").appendChild(a),vars.GetBuffTooltipFunc=function(e){return function(){var t=vars.buffsById[e];s.textContent=t.name;var a=_Mathmax(200,s.clientWidth+78),i=t.desc.replace(Game.sayTime(t.maxTime,-1),"$&"),n="<div class=\"prompt\" style=\"white-space:nowrap;min-width:"+a+"px;text-align:center;font-size:11px;margin:8px 0px;\"><h3>"+t.name+"</h3><div class=\"line\"></div>"+i;return settings.buffTooltipDuration&&(n+="<div class=\"line\"></div>"+Game.sayTime(t.time,-1)+" left"),n+="</div>",n}};var i=setInterval(function(){var e=Game.Objects["Wizard tower"].minigame;e&&(e.spells["stretch time"].win=replaceCode(e.spells["stretch time"].win,[{pattern:"me.maxTime+=gain;",replacement:"\n\t\t\t\t\tlet timePattern = RegExp(Game.sayTime(me.maxTime,-1), 'g');\n\t\t\t\t\tme.desc = me.desc.replace(timePattern, Game.sayTime(me.maxTime + gain,-1));\n\t\t\t\t\t$&"}]),clearInterval(i))},250)}),miscGrandmaFixes=new Patch(function(){for(var e=0,t=Game.GrandmaSynergies;e<t.length;e++){var a=t[e],s=Game.Upgrades[a];s.desc=s.desc.replace(/(efficient\.) /,"$1<br>"),s.baseDesc=s.desc}Game.Upgrades["Cosmic grandmas"].order+=.2,Game.Upgrades["Transmuted grandmas"].order+=.2,Game.Upgrades["Altered grandmas"].order+=.2,Game.Upgrades["Grandmas' grandmas"].order+=.2,Game.GrandmaSynergies.sort(function(e,t){return Game.Upgrades[e].order-Game.Upgrades[t].order});var i=Game.Upgrades["Script grannies"];i.buyFunction=i.buyFunction?replaceCode(i.buyFunction,[{pattern:"{",replacement:"$&\nGame.Objects['Grandma'].redraw();"}]):function(){Game.Objects.Grandma.redraw()},Game.Objects.Portal.tooltip=replaceCode(Game.Objects.Portal.tooltip,[{pattern:"synergiesWith[other.plural]+=boost/(other.storedTotalCps*Game.globalCpsMult);",replacement:"synergiesWith[other.plural] += (me.amount * 0.05)/other.baseCps;"}]),Game.Objects.Grandma.tooltip=replaceCode(Game.Objects.Grandma.tooltip,[{pattern:"for (var i in Game.GrandmaSynergies)",replacement:"let selfBoost = 0;\n\t\t\t\tif(Game.Has('One mind')) selfBoost += (me.amount * 0.02)/me.baseCps;\n\t\t\t\tif(Game.Has('Communal brainsweep')) selfBoost += (me.amount * 0.02)/me.baseCps;\n\t\t\t\tif(!synergiesWith[me.plural]) synergiesWith[me.plural] = 0;\n\t\t\t\tsynergyBoost += selfBoost;\n\t\t\t\tsynergiesWith[me.plural] += selfBoost;\n\t\t\t$&"}])}),statsUpgradeCategories=new Patch(function(){Game.UpdateMenu=replaceCode(Game.UpdateMenu,[{pattern:"var cookieUpgrades='';",replacement:"$&\n\t\t\t\tvar techUpgrades = '';\n\t\t\t\tvar seasonalUpgrades = '';\n\t\t\t"},{pattern:"else if (me.pool=='cookie'",replacement:"else if (OmniCookies.settings.separateTechs && me.pool == 'tech') techUpgrades+=str2;\n\t\t\t\telse if(OmniCookies.settings.separateSeasons && me.unlockAt && (me.unlockAt.season || me.unlockAt.displaySeason)) seasonalUpgrades+=str2;\n\t\t\t$&"},{pattern:"cookieUpgrades+'</div>'):'')+",replacement:"$&\n\t\t\t\t(techUpgrades!=''?('<div class=\"listing\"><b>Technologies</b></div>'+\n\t\t\t\t'<div class=\"listing crateBox\">'+techUpgrades+'</div>'):'')+\n\t\t\t\t(seasonalUpgrades!=''?('<div class=\"listing\"><b>Seasonal</b></div>'+\n\t\t\t\t'<div class=\"listing crateBox\">'+seasonalUpgrades+'</div>'):'')+\n\t\t\t"}])}),displaySeasonUnlock=new Patch(function(){function e(e,t){"string"==typeof e&&(e=Game.Upgrades[e]),e.unlockAt||(e.unlockAt={cookies:0,name:e.name}),e.unlockAt.displaySeason=t}var t=Game.santaDrops.slice(0,Game.santaDrops.length);t.push("A festive hat"),t.push("Santa's dominion"),Game.crateTooltip=replaceCode(Game.crateTooltip,[{pattern:"\tmysterious=0",replacement:"\tvar $&"},{pattern:/(\/\*|\*\/)/g,replacement:""},{pattern:"else if (me.unlockAt.season)",replacement:"else if (OmniCookies.settings.displaySeasons && me.unlockAt.season)"},{pattern:"else if (me.unlockAt.text)",replacement:"\n\t\t\t\telse if (OmniCookies.settings.displaySeasons && me.unlockAt.displaySeason)\n\t\t\t\t{\n\t\t\t\t\tvar it=Game.seasons[me.unlockAt.displaySeason];\n\t\t\t\t\tdesc='<div style=\"font-size:80%;text-align:center;\">From <div class=\"icon\" style=\"vertical-align:middle;display:inline-block;'+(Game.Upgrades[it.trigger].icon[2]?'background-image:url('+Game.Upgrades[it.trigger].icon[2]+');':'')+'background-position:'+(-Game.Upgrades[it.trigger].icon[0]*48)+'px '+(-Game.Upgrades[it.trigger].icon[1]*48)+'px;transform:scale(0.5);margin:-16px;\"></div> '+it.name+'</div><div class=\"line\"></div>'+desc;\n\t\t\t\t}\n\t\t\t$&"}]);for(var a,s=0,i=Game.reindeerDrops;s<i.length;s++)a=i[s],e(a,"christmas");for(var n,r=0,o=t;r<o.length;r++)n=o[r],e(n,"christmas");for(var c,d=0,m=Game.halloweenDrops;d<m.length;d++)c=m[d],e(c,"halloween");for(var u,p=0,g=Game.easterEggs;p<g.length;p++)u=g[p],e(u,"easter")}),skruuiaRebalance=new Patch(function(){Game.UpdateWrinklers=replaceCode(Game.UpdateWrinklers,[{pattern:/(var godLvl=)(Game\.hasGod\('scorn'\))(;\s*if \(godLvl==1\) me\.sucked\*=1\.15;)/m,replacement:"$1OmniCookies.settings.skruuiaRebalance ? 0 : $2$3"}])}),cursedFingerTweaks=new Patch(function(){vars.cursedPs=Game.cookiesPs,vars.cursedPsMult=Game.globalCpsMult;var e=Game.buffTypesByName["cursed finger"];e.func=replaceCode(e.func,[{pattern:"multCpS:0,",replacement:"multCpS:1,"},{pattern:"<br>but each click is worth ",replacement:"<br>but each click generates "}]),cursedFingerPart2.apply();var t=Game.hasBuff("Cursed finger");t&&(t.multCpS=1,t.desc=t.desc.replace("is worth","generates"),Game.recalculateGains=1)},function(){var e=Game.buffTypesByName["cursed finger"];e.func=replaceCode(e.func,[{pattern:"multCpS:1,",replacement:"multCpS:0,"},{pattern:"<br>but each click generates ",replacement:"<br>but each click is worth "}]);var t=Game.hasBuff("Cursed finger");t&&(t.multCpS=0,t.desc=t.desc.replace("generates","is worth"),t.power=vars.cursedPs*t.maxTime/Game.fps,Game.recalculateGains=1)}),cursedFingerPart2=new Patch(function(){Game.CalculateGains=replaceCode(Game.CalculateGains,[{pattern:"Game.computedMouseCps=Game.mouseCps();",replacement:"$&\n\t\t\t\tif(OmniCookies.settings.cursedFinger && Game.hasBuff('Cursed finger')) {\n\t\t\t\t\tOmniCookies.vars.cursedPs = Game.cookiesPs;\n\t\t\t\t\tOmniCookies.vars.cursedPsMult = Game.globalCpsMult;\n\t\t\t\t\tGame.globalCpsMult = 0;\n\t\t\t\t\tGame.cookiesPs = 0;\n\t\t\t\t\tGame.computedMouseCps = 0;\n\t\t\t\t}"}]);var e=document.getElementById("bigCookie");e.removeEventListener("click",Game.ClickCookie),Game.ClickCookie=replaceCode(Game.ClickCookie,[{pattern:"Game.handmadeCookies+=amount;",replacement:"$&\n\t\t\t\tif(OmniCookies.settings.cursedFinger && Game.hasBuff('Cursed finger')) {\n\t\t\t\t\tGame.Dissolve(amount);\n\t\t\t\t\tGame.handmadeCookies-=amount;\n\t\t\t\t\tamount = OmniCookies.vars.cursedPs * Game.buffs['Cursed finger'].maxTime/Game.fps;\n\t\t\t\t\tGame.cookiesPs = OmniCookies.vars.cursedPs;\n\t\t\t\t\tGame.globalCpsMult = OmniCookies.vars.cursedPsMult;\n\t\t\t\t\tOmniCookies.Util.gainInstantPassiveCpS(Game.buffs['Cursed finger'].maxTime/Game.fps);\n\t\t\t\t\tGame.cookiesPs = 0;\n\t\t\t\t\tGame.globalCpsMult = 0;\n\t\t\t\t}"}]),AddEvent(e,"click",Game.ClickCookie)}),tooltipWobble=new Patch(function(){Game.tooltip.wobble=replaceCode(Game.tooltip.wobble,[{pattern:"if (false)",replacement:"if (OmniCookies.settings.tooltipWobble)"}])}),cycliusGains=new Patch(function(){Game.CalculateGains=replaceCode(Game.CalculateGains,[{pattern:/\(Date\.now\(\)\/1000\/\(60\*60\*(\d+)\)\)\*Math\.PI\*2/g,replacement:"OmniCookies.Util.cycliusCalc($1, OmniCookies.settings.zonedCyclius)"}])}),stockInfo=new Patch(function(){onMinigameLoaded("Bank",function(){var e=Game.Objects.Bank.minigame;e.buyGood=replaceCode(e.buyGood,[{pattern:"return true;",replacement:"\n\t\t\t\t\tlet realCostInS = costInS * overhead;\n\t\t\t\t\tif(!OmniCookies.saveData.stockAverages[id] || me.stock == n) {\n\t\t\t\t\t\tOmniCookies.saveData.stockAverages[id] = {\n\t\t\t\t\t\t\tavgValue: realCostInS,\n\t\t\t\t\t\t\ttotalValue: realCostInS*n\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet avg = OmniCookies.saveData.stockAverages[id];\n\t\t\t\t\t\tavg.totalValue += realCostInS*n;\n\t\t\t\t\t\tavg.avgValue = avg.totalValue/me.stock;\n\t\t\t\t\t}\n\t\t\t\t$&"}],"var M = Game.Objects['Bank'].minigame;"),e.sellGood=replaceCode(e.sellGood,[{pattern:"return true;",replacement:"\n\t\t\t\t\tif(OmniCookies.saveData.stockAverages[id]) {\n\t\t\t\t\t\tlet avg = OmniCookies.saveData.stockAverages[id];\n\t\t\t\t\t\tavg.totalValue -= avg.avgValue*n;\n\t\t\t\t\t}\n\t\t\t\t$&"}],"var M = Game.Objects['Bank'].minigame;"),e.drawGraph=replaceCode(e.drawGraph,[{pattern:/}$/,replacement:"\n\t\t\t\t\tif(OmniCookies.settings.stockValueData && M.hoverOnGood != -1) {\n\t\t\t\t\t\tlet me = M.goodsById[M.hoverOnGood];\n\t\t\t\t\t\tif(me.stock > 0 && OmniCookies.saveData.stockAverages[M.hoverOnGood]) {\n\t\t\t\t\t\t\tctx.strokeStyle='#00ff00'; // green\n\t\t\t\t\t\t\tctx.beginPath();\n\t\t\t\t\t\t\tlet lineHeight = Math.floor(height-OmniCookies.saveData.stockAverages[M.hoverOnGood].avgValue*M.graphScale)+0.5;\n\t\t\t\t\t\t\tctx.moveTo(width-1, lineHeight);\n\t\t\t\t\t\t\tctx.lineTo(width-span*rows-1, lineHeight);\n\t\t\t\t\t\t\tctx.stroke();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t$&"}],"var M = Game.Objects['Bank'].minigame;"),e.draw=replaceCode(e.draw,[{pattern:"//if (me.stock>0) me.stockL.style.color='#fff';",replacement:"\n\t\t\t\t\tif(OmniCookies.settings.stockValueData) {\n\t\t\t\t\t\tif(!me.avgL) {\n\t\t\t\t\t\t\tlet avgSpan = document.createElement('span');\n\t\t\t\t\t\t\tavgSpan.id = 'bankGood-'+me.id+'-avg';\n\t\t\t\t\t\t\tavgSpan.innerHTML = '(-)';\n\t\t\t\t\t\t\tdocument.getElementById('bankGood-'+me.id+'-stockBox').appendChild(avgSpan);\n\t\t\t\t\t\t\tme.avgL = avgSpan;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(OmniCookies.saveData.stockAverages[me.id] && me.stock > 0) {\n\t\t\t\t\t\t\tme.avgL.style.visibility = 'visible';\n\t\t\t\t\t\t\tlet avg = OmniCookies.saveData.stockAverages[me.id];\n\t\t\t\t\t\t\tme.avgL.innerHTML = ' ($$'+Beautify(avg.avgValue,2)+')';\n\t\t\t\t\t\t\tif(avg.avgValue < me.val) {\n\t\t\t\t\t\t\t\tme.avgL.classList.remove('red');\n\t\t\t\t\t\t\t\tme.avgL.classList.add('green');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.avgL.classList.remove('green');\n\t\t\t\t\t\t\t\tme.avgL.classList.add('red');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.avgL.style.visibility = 'hidden';\n\t\t\t\t\t\t\tme.avgL.innerHTML = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(me.avgL) {\n\t\t\t\t\t\t\tme.avgL.remove();\n\t\t\t\t\t\t\tme.avgL = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t$&"}],"var M = Game.Objects['Bank'].minigame;"),e.toRedraw=1})}),fancyBuildings=new Patch(function(){Game.Draw=replaceCode(Game.Draw,[{pattern:"if (Game.prefs.animate && ((Game.prefs.fancy && Game.drawT%1==0)",replacement:"if (Game.prefs.animate && ((((Game.prefs.fancy || OmniCookies.settings.buildingsBypassFancy == 0) && OmniCookies.settings.buildingsBypassFancy != 1) && Game.drawT%1==0)"}])}),fancyCursors=new Patch(function(){Game.DrawBackground=replaceCode(Game.DrawBackground,[{pattern:/(var fancy=)(Game\.prefs\.fancy)(;)/,replacement:"$1($2 || OmniCookies.settings.cursorsBypassFancy == 0) && OmniCookies.settings.cursorsBypassFancy != 1$3"}])}),fancyWrinklers=new Patch(function(){window.inRect=function(e,t,a){var s=Math.cos,i=e+_Mathsin(-a.r)*-(a.h/2-a.o),n=t+s(-a.r)*-(a.h/2-a.o),r=Math.sqrt(i*i+n*n),o=Math.atan2(n,i),c=o-a.r,d=s(c)*r,m=_Mathsin(c)*r;return!!(d>-.5*a.w&&d<.5*a.w&&m>-.5*a.h&&m<.5*a.h)},Game.UpdateWrinklers=replaceCode(Game.UpdateWrinklers,[{pattern:/Game\.prefs\.fancy/g,replacement:"($& || OmniCookies.settings.wrinklersBypassFancy == 0) && OmniCookies.settings.wrinklersBypassFancy != 1"}])}),buySellBulk=new Patch(function(){var e=[{pattern:"l('productPriceMult'+me.id).textContent=(Game.buyBulk>1)?('x'+Game.buyBulk+' '):'';",replacement:"\n\t\t\t\tif(OmniCookies.settings.enhancedBulk) {\n\t\t\t\t\tlet bulkAmount = -1;\n\t\t\t\t\tlet bulkPrice = -1;\n\t\t\t\t\tif(Game.buyMode == -1) {\n\t\t\t\t\t\tbulkAmount = (Game.buyBulk > -1) ? Math.min(Game.buyBulk, me.amount) : me.amount;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet bulk = OmniCookies.Util.calcMaxBuyBulk(me, Game.buyBulk);\n\t\t\t\t\t\tbulkAmount = bulk.maxAmount;\n\t\t\t\t\t\tbulkPrice = bulk.maxPrice;\n\t\t\t\t\t}\n\t\t\t\t\tl('productPriceMult'+me.id).textContent = bulkAmount > 1 ? 'x' + bulkAmount + ' ' : '';\n\t\t\t\t} else {\n\t\t\t\t\t$&\n\t\t\t\t}\n\t\t\t"}],t=[{pattern:"if (Game.buyMode==1) this.bulkPrice=this.getSumPrice(Game.buyBulk);",replacement:"if (Game.buyMode==1) {\n\t\t\t\tif(OmniCookies.settings.enhancedBulk) {\n\t\t\t\t\tlet bulk = OmniCookies.Util.calcMaxBuyBulk(this,Game.buyBulk);\n\t\t\t\t\tthis.bulkPrice = bulk.maxPrice > 0 ? bulk.maxPrice : this.price;\n\t\t\t\t} else {\n\t\t\t\t\tthis.bulkPrice=this.getSumPrice(Game.buyBulk);\n\t\t\t\t}\n\t\t\t}"},{pattern:"else if (Game.buyMode==-1 && Game.buyBulk==-1) this.bulkPrice=this.getReverseSumPrice(1000);",replacement:"else if (Game.buyMode==-1 && Game.buyBulk==-1) this.bulkPrice=this.getReverseSumPrice(OmniCookies.settings.enhancedBulk ? this.amount : 1000);"}];for(var a in Game.Objects){var s=Game.Objects[a];s.rebuild=replaceCode(s.rebuild,e),s.refresh=replaceCode(s.refresh,t)}Game.Object=replaceCode(Game.Object,e),Game.Object=replaceCode(Game.Object,t),Game.storeBulkButton=replaceCode(Game.storeBulkButton,[{pattern:"if (Game.buyMode==1 && Game.buyBulk==-1) Game.buyBulk=100;",replacement:"\n\t\t\t\tif(id == 0 || id == 1) {\n\t\t\t\t\tlet text = 'all';\n\t\t\t\t\tif(OmniCookies.settings.enhancedBulk) {\n\t\t\t\t\t\tif(Game.buyMode == -1) text = 'ALL';\n\t\t\t\t\t\telse text = 'MAX';\n\t\t\t\t\t}\n\t\t\t\t\tl('storeBulkMax').textContent = text;\n\t\t\t\t}\n\t\t\t\tif (!OmniCookies.settings.enhancedBulk && Game.buyMode==1 && Game.buyBulk==-1) Game.buyBulk=100;"},{pattern:"l('storeBulkMax').style.visibility='hidden';",replacement:"if(!OmniCookies.settings.enhancedBulk) $&"}]),Game.Logic=replaceCode(Game.Logic,[{pattern:"if (!Game.promptOn)",replacement:"\n\t\t\t\tlet activeShortcut = (OmniCookies.Util.holdingButton(16)*2) | (OmniCookies.Util.holdingButton(17));\n\t\t\t$&"},{pattern:"if ((Game.keys[16] || Game.keys[17]) && !Game.buyBulkShortcut)",replacement:"if (activeShortcut != OmniCookies.vars.prevShortcut && (OmniCookies.settings.enhancedBulk ? true : activeShortcut == 2 || activeShortcut == 1))"},{pattern:"Game.buyBulkOld=Game.buyBulk;",replacement:"if(OmniCookies.vars.prevShortcut == 0) Game.buyBulkOld=Game.buyBulk;"},{pattern:"if (Game.keys[17]) Game.buyBulk=10;",replacement:"$&\n\t\t\t\tif(activeShortcut == 3 && OmniCookies.settings.enhancedBulk) Game.buyBulk = -1;\n\t\t\t"},{pattern:"//handle cookies",replacement:"\n\t\t\t\tOmniCookies.vars.prevShortcut = activeShortcut;\n\t\t\t$&"}]),updateBulkAll()}),updateBulkAll=function(){1==Game.buyMode&&(-1==Game.buyBulk&&!settings.enhancedBulk&&Game.storeBulkButton(4),l("storeBulkMax").style.visibility=settings.enhancedBulk?"visible":"hidden");var e="all";settings.enhancedBulk&&(-1==Game.buyMode?e="ALL":e="MAX"),l("storeBulkMax").textContent=e,Game.RefreshStore()},dangerousStocks=new Patch(function(){onMinigameLoaded("Bank",function(){var e=Game.Objects.Bank.minigame;e.buyGood=replaceCode(e.buyGood,[{pattern:"Game.Spend(cost*n);",replacement:"\n\t\t\t\t\tif(OmniCookies.settings.dangerousStocks) {\n\t\t\t\t\t\tGame.Dissolve(cost*n);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$&\n\t\t\t\t\t}\n\t\t\t\t"}],"let M = Game.Objects['Bank'].minigame;"),e.sellGood=replaceCode(e.sellGood,[{pattern:"//Game.Earn",replacement:"if(OmniCookies.settings.dangerousStocks) Game.Earn"},{pattern:/\tGame\.cookies/gm,replacement:"if(!OmniCookies.settings.dangerousStocks) $&"}],"let M = Game.Objects['Bank'].minigame;")})}),cycliusInfo=new Patch(function(){onMinigameLoaded("Temple",function(){var e=Game.Objects.Temple.minigame,t=[{pattern:/\+me\.desc(\w+)\+/g,replacement:"+((typeof me.desc$1 == 'function') ? me.desc$1() : me.desc$1)+"}];e.godTooltip=replaceCode(e.godTooltip,t,"let M = Game.Objects['Temple'].minigame;"),e.slotTooltip=replaceCode(e.slotTooltip,t,"let M = Game.Objects['Temple'].minigame;");var a=function(e){return function(){var t="";if(settings.detailedCyclius){var a=100*(.15*_Mathsin(cycliusCalc(e,settings.zonedCyclius))),s=0<a?"green":"red",i=0<a?"+":"",n=Beautify(a,2);"0"==n&&(s=""),-.1>a&&"0"==n&&(s="red"),0>a&&!n.includes("-")&&(n="-"+n),t="<div style=\"display:inline-block;text-align:right;width:50%;\" class=\""+s+"\">"+i+n+"% base CpS.</div>"}return"<div style=\"display:inline-block;width:49%;\">Effect cycles over "+e+" hours.</div>"+t}},s=e.gods.ages;toggleCyclius(),s.desc1=a(3),s.desc2=a(12),s.desc3=a(24)})}),toggleCyclius=function(){var e=Game.Objects.Temple.minigame,t=e.gods.ages;t.activeDescFunc?(t.activeDescBackup=t.activeDescFunc,t.activeDescFunc=void 0):(t.activeDescFunc=t.activeDescBackup,t.activeDescBackup=void 0)},optiCookies=new Patch(function(){Game.Draw=replaceCode(Game.Draw,[{pattern:"if (price<lastPrice) Game.storeToRefresh=1;",replacement:"if (price<lastPrice && price!=0) Game.upgradesToRebuild=1;"}]);for(var e,t=0,a=Game.ObjectsById;t<a.length;t++)e=a[t],e.getSumPrice=function(e){return quickCalcBulkPrice(this,e)},e.getReverseSumPrice=function(e){return quickCalcBulkPrice(this,e,!0)}}),dangerousBrokers=new Patch(function(){onMinigameLoaded("Bank",function(){var t=Game.Objects.Bank.minigame,a=l("bankBrokersBuy"),s=a.parentElement,i=document.createElement("div");i.classList.add("bankButton","bankButtonBuy","bankButtonOff"),i.id="bankBrokersBuy",i.innerHTML="Hire",i.onclick=function(a){t.brokers<t.getMaxBrokers()&&Game.cookies>=t.getBrokerPrice()&&(settings.dangerousBrokers&&settings.dangerousStocks?Game.Dissolve(t.getBrokerPrice()):Game.Spend(t.getBrokerPrice()),t.brokers+=1,settings.dangerousBrokers&&(t.profit-=1200),PlaySound("snd/cashIn2.mp3",.6),Game.SparkleOn(a.target))},a.remove(),s.appendChild(i)})}),_Patches=Object.freeze({__proto__:null,scrollbarStyle:scrollbarStyle$1,updateMenu:updateMenu,smoothBuildings:smoothBuildings,scrollingBuildings:scrollingBuildings,buildingTooltips:buildingTooltips,buffTooltips:buffTooltips,miscGrandmaFixes:miscGrandmaFixes,statsUpgradeCategories:statsUpgradeCategories,displaySeasonUnlock:displaySeasonUnlock,skruuiaRebalance:skruuiaRebalance,cursedFingerTweaks:cursedFingerTweaks,tooltipWobble:tooltipWobble,cycliusGains:cycliusGains,stockInfo:stockInfo,fancyBuildings:fancyBuildings,fancyCursors:fancyCursors,fancyWrinklers:fancyWrinklers,buySellBulk:buySellBulk,updateBulkAll:updateBulkAll,dangerousStocks:dangerousStocks,cycliusInfo:cycliusInfo,toggleCyclius:toggleCyclius,optiCookies:optiCookies,dangerousBrokers:dangerousBrokers}),OptionedButton=function(){function e(e,t,a){this.settingName=e,this.options=t,this.desc=a}return e.prototype.display=function(){var e=document.createElement("div"),t=+settings[this.settingName],s=this.options[t],i="OmniCookiesButton_"+this.settingName,n=document.createElement("a");n.id=i,n.className="option"+(s.off?" off":"");var a=this.settingName,r=this.options;n.onclick=this.toggleFunction(i,a,r),n.textContent=s.text,e.appendChild(n);var o=document.createElement("label");return o.textContent=this.desc,e.appendChild(o),e},e.prototype.toggleFunction=function(e,t,a){return function(){settings[t]++,settings[t]>=a.length&&(settings[t]=0);var s=document.getElementById(e),i=a[settings[t]];i.off?s.classList.add("off"):s.classList.remove("off"),i.func&&i.func(),s.innerHTML=i.text,PlaySound("snd/tick.mp3")}},e}(),BooleanButton=function(e){function t(t,a,s,i){var n=e.call(this,t,[s,a],i)||this;return n.onOption=a,n.offOption=s,s.off=!0,n}return __extends(t,e),t}(OptionedButton),Header=function(){function e(e){this.text=e}return e.prototype.display=function(){var e=document.createElement("div");return e.className="listing",e.style.padding="5px 16px",e.style.opacity="0.7",e.style.fontSize="17px",e.style.fontFamily="\"Kavoon\", Georgia, serif",e.appendChild(document.createTextNode(this.text)),e},e}(),Title=function(){function e(e){this.text=e}return e.prototype.display=function(){var e=document.createElement("div");return e.className="title",e.textContent=this.text,e},e}(),Listing=function(){function e(e){this.elements=e}return e.prototype.display=function(){var e=document.createElement("div");e.className="listing";for(var t,a=0,s=this.elements;a<s.length;a++)t=s[a],e.appendChild(t.display());return e},e}(),ConfigMenu=function(){function e(e){this.elements=e}return e.prototype.display=function(){for(var e,t=document.createDocumentFragment(),a=0,s=this.elements;a<s.length;a++)e=s[a],t.appendChild(e.display());return t},e}(),menuDisplay=new ConfigMenu([new Title("Omniscient Cookies "+version),new Header("Graphical tweaks"),new Listing([new BooleanButton("autoScrollbar",{text:"Autohide center scrollbar ON",func:function(){return scrollbarStyle("auto")}},{text:"Autohide center scrollbar OFF",func:function(){return scrollbarStyle("scroll")}},"(the scrollbar in the center view will hide itself when appropriate)"),new BooleanButton("scrollingBuildings",{text:"Scroll buildings ON"},{text:"Scroll buildings OFF"},"(hovering over the left/right edges of buildings produces a scroll effect)"),new BooleanButton("smoothBuildings",{text:"Smooth buildings ON"},{text:"Smooth buildings OFF"},"(buildings draw every frame, instead of every 3 frames)"),new BooleanButton("betterBuildingTooltips",{text:"Improved building tooltips ON",func:function(){return buildingTooltips.apply()}},{text:"Improved building tooltips OFF"},"(building tooltips in the shop look a little better)"),new BooleanButton("betterGrandmas",{text:"Grandma fixes ON",func:function(){return miscGrandmaFixes.apply()}},{text:"Grandma fixes OFf"},"(text and ordering fixes for grandma synergy upgrades; disabling requires refresh)"),new BooleanButton("bringGrandmaToWork",{text:"Bring grandma to work day ON"},{text:"Bring grandma to work day OFF"},"(synergy grandmas make an appearance in their respective building views)"),new BooleanButton("separateTechs",{text:"Separate techs ON",func:function(){return statsUpgradeCategories.apply()}},{text:"Separate techs OFF"},"(gives tech upgrades their own upgrade category under cookies)"),new BooleanButton("separateSeasons",{text:"Separate seasons ON",func:function(){return statsUpgradeCategories.apply()}},{text:"Separate seasons OFF"},"(gives seasonal upgrades their own upgrade category under cookies)"),new BooleanButton("displaySeasons",{text:"Display seasonal sources ON",func:function(){return displaySeasonUnlock.apply()}},{text:"Display seasonal sources OFF"},"(shows source season in upgrade tooltips)"),new BooleanButton("fancyMilkSelect",{text:"Fancy milk select ON"},{text:"Fancy milk select OFF",func:function(){switchMilkIcon(1),vars.lastMilk=-1,vars.lastAutoMilk=-1}},"(milk selector icon changes with selected milk)"),new BooleanButton("tooltipWobble",{text:"Tooltip wobble ON"},{text:"Tooltip wobble OFF",func:function(){return Game.tooltip.tt.className="framed"}},"(enables the tooltip wobble animation)"),new BooleanButton("improveAscendMeter",{text:"Fancy ascend meter ON"},{text:"Fancy ascend meter OFF",func:function(){return Game.ascendMeter.style.removeProperty("width")}},"(meter and number total update faster and smoother)"),new OptionedButton("buildingsBypassFancy",[{text:"Buildings always FANCY"},{text:"Buildings always FAST"},{text:"Buildings always DEFAULT",off:!0}],"(buildings follow this setting rather than default)"),new OptionedButton("cursorsBypassFancy",[{text:"Cursors always FANCY"},{text:"Cursors always FAST"},{text:"Cursors always DEFAULT",off:!0}],"(cursors follow this setting rather than default)"),new OptionedButton("wrinklersBypassFancy",[{text:"Wrinklers always FANCY"},{text:"Wrinklers always FAST"},{text:"Wrinklers always DEFAULT",off:!0}],"(wrinklers follow this setting rather than default)")]),new Header("Quality of Life"),new Listing([new BooleanButton("enhancedBulk",{text:"Enhanced bulk ON",func:function(){return updateBulkAll()}},{text:"Enhanced bulk OFF",func:function(){return updateBulkAll()}},"(allows partial and maximum bulk purchases)"),new BooleanButton("buffTooltipDuration",{text:"Show buff duration in tooltip ON"},{text:"Show buff duration in tooltip OFF"},"(buffs will show their current duration in their tooltip)")]),new Header("Stock Market"),new Listing([new BooleanButton("stockValueData",{text:"Stock value data ON"},{text:"Stock value data OFF"},"(displays information about how profitable your stocks are)"),new BooleanButton("dangerousStocks",{text:"Dangerous stocks ON"},{text:"Dangerous stocks OFF"},"(stock market affects total cookies earned)"),new BooleanButton("dangerousBrokers",{text:"Dangerous brokers ON",func:function(){return dangerousBrokers.apply()}},{text:"Dangerous brokers OFF"},"(hiring brokers reduces your Stock Market profits)")]),new Header("Pantheon"),new Listing([new BooleanButton("detailedCyclius",{text:"Cyclius details ON",func:function(){return toggleCyclius()}},{text:"Cyclius details OFF",func:function(){return toggleCyclius()}},"(shows Cyclius' current cycles in his tooltip)"),new BooleanButton("zonedCyclius",{text:"Zoned Cyclius ON",func:function(){return Game.recalculateGains=1}},{text:"Zoned Cyclius OFF",func:function(){return Game.recalculateGains=1}},"(offsets Cyclius based on your time zone, towards GMT+1)"),new BooleanButton("trueCyclius",{text:"True Cyclius ON"},{text:"True Cyclius OFF"},"(cosmetic; Cyclius shows off his power with style)"),new BooleanButton("skruuiaRebalance",{text:"Skruuia rebalance ON"},{text:"Skruuia rebalance OFF"},"(Skruuia's bonus applies to wrinkler suck rate rather than wrinkler pop multiplier)")]),new Header("Grimoire"),new Listing([new BooleanButton("improveMagicMeter",{text:"Improved magic meter ON"},{text:"Improved magic meter OFF"},"(slight improvements to the magic meter; disabling requires refresh)")]),new Header("Experimental"),new Listing([new BooleanButton("optimizeBuildings",{text:"Buildings draw smart ON"},{text:"Buildings draw smart OFF"},"(experimental; buildings attempt to skip unnecessary draw frames)"),new BooleanButton("preserveWrinklers",{text:"Preserve wrinklers ON"},{text:"Preserve wrinklers OFF"},"(experimental; attempts to preserve all wrinkler data on game save/load)"),new BooleanButton("cursedFinger",{text:"Cursed Finger tweaks ON",func:function(){return cursedFingerTweaks.apply()}},{text:"Cursed Finger tweaks OFF",func:function(){return cursedFingerTweaks.remove()}},"(experimental; CF does not snapshot and counts as real passive CpS)"),new BooleanButton("optiCookies",{text:"OptiCookies ON",func:function(){return optiCookies.apply()}},{text:"OptiCookies OFF"},"(experimental; a couple of small performance tweaks; disabling requires refresh)")])]),_Config=Object.freeze({__proto__:null,customOptionsMenu:customOptionsMenu}),RoutineFunction=function(){return function(e,t){void 0===t&&(t=function(){return!0}),this.func=e,this.enabled=t}}(),Routine=function(){function e(e){void 0===e&&(e={}),this.routines=e}return e.prototype.run=function(){for(var e in this.routines)this.routines[e].enabled&&this.routines[e].enabled()&&this.routines[e].func()},e.prototype.register=function(e,t){this.routines[e]=new RoutineFunction(t)},e}(),RoutineCollection=function(){return function(){}}(),LogicRoutineCollection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.improveAscendMeter=new RoutineFunction(function(){var e=Game.ascendMeter,t=Game.ascendNumber,a=Game.HowMuchPrestige(Game.cookiesReset),s=_Mathfloor(Game.HowMuchPrestige(Game.cookiesReset+Game.cookiesEarned)),i=s-_Mathfloor(a),n=window.Spice;"undefined"!=typeof n&&n.settings.numericallyStableHeavenlyChipGains&&(n.additionalHeavenlyChips?i=n.additionalHeavenlyChips():n.stableHeavenlyChipGains&&(i=n.stableHeavenlyChipGains()));var r=Game.HowManyCookiesReset(_Mathfloor(a+i+1))-Game.HowManyCookiesReset(_Mathfloor(a+i)),o=Game.HowManyCookiesReset(s+1)-(Game.cookiesEarned+Game.cookiesReset),c=1-o/r;vars.ascendMeterPercent||(vars.ascendMeterPercent=c),vars.ascendMeterLevel||(vars.ascendMeterLevel=i),i!=vars.ascendMeterLevel&&(vars.levelDiff+=i-vars.ascendMeterLevel,vars.ascendMeterLevel=i),Game.ascendMeterPercent=vars.ascendMeterPercent;var d=.1*(vars.levelDiff+c-Game.ascendMeterPercent);Game.ascendMeterPercent+=d;var m=!1,u=!1;2<=Game.ascendMeterPercent&&(m=!0),-1>=Game.ascendMeterPercent&&(u=!0),1<=Game.ascendMeterPercent&&(vars.levelDiff-=_Mathfloor(Game.ascendMeterPercent)),0>Game.ascendMeterPercent&&(vars.levelDiff-=_Mathfloor(Game.ascendMeterPercent)),0>Game.ascendMeterPercent&&(Game.ascendMeterPercent=1-_Mathabs(Game.ascendMeterPercent)),Game.ascendMeterPercent%=1,e.style.transform="";var p=100*Game.ascendMeterPercent;p=m?100:p,p=u?0:p,e.style.width=p+"%",t.textContent="+"+window.SimpleBeautify(i-vars.levelDiff),vars.ascendMeterPercent=Game.ascendMeterPercent,e.style.removeProperty("width")},function(){return settings.improveAscendMeter}),t.updateSkruuiaRebalance=new RoutineFunction(function(){var e=1;if(settings.skruuiaRebalance&&Game.hasGod){var t=Game.hasGod("scorn");1===t?e=1.15:2===t?e=1.1:3===t?e=1.05:void 0}var a=Game.Objects.Temple.minigame;a&&("undefined"==typeof a.effs&&(a.effs={}),e!=a.effs.wrinklerEat&&(Game.recalculateGains=1),a.effs.wrinklerEat=e)}),t.bulkStoreRefresh=new RoutineFunction(function(){return Game.storeToRefresh=1},function(){return settings.enhancedBulk&&0==Game.T%10}),t}return __extends(t,e),t}(RoutineCollection),LogicRoutine=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Routine),logicRoutine=new LogicRoutine(new LogicRoutineCollection()),DrawRoutineCollection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateMilkIcon=new RoutineFunction(function(){0==Game.milkType&&Game.Milk!=vars.lastAutoMilk?(switchMilkIcon(0),vars.lastAutoMilk=Game.Milk):Game.milkType!=vars.lastMilk&&(switchMilkIcon(Game.milkType),vars.lastMilk=Game.milkType)},function(){return settings.fancyMilkSelect}),t.grimoireMeterFix=new RoutineFunction(function(){var e=Number.parseFloat;this.hasRun=!0;var t=document.getElementById("grimoireBar");if(t){var a=document.getElementById("grimoireBarFull");if(t.className.includes("meterContainer")){a.style.height="8px",a.style.transform="scale(2,2)",a.style.transformOrigin="0 0";var s=document.createElement("div");s.className=t.className,s.style.overflow="hidden",s.style.height="100%",t.className="",t.style.position="relative",t.replaceChild(s,a),s.appendChild(a)}a.style.width=e(a.style.width)/2+"%"}},function(){return settings.improveMagicMeter||this.hasRun}),t.trueCyclius=new RoutineFunction(function(){var e=document.getElementById("templeGod3");if(e){var t=e.getElementsByClassName("usesIcon")[0],a=Game.hasGod("ages");if(a){if(t.classList.contains("shadowFilter")){var s=document.createElement("div");s.classList.add("templeIcon"),s.classList.add("shadowFilter"),s.style.margin="unset",t.classList.remove("shadowFilter"),t.style.animation="none",e.removeChild(t),e.appendChild(s),s.appendChild(t),vars.patchedTrueCyclius=!0}var i=0,n=0;settings.trueCyclius?(1===a?i=3:2===a?i=12:3===a?i=24:void 0,n=cycliusCalc(i,settings.zonedCyclius)-_MathPI/2,t.style.setProperty("transform","rotate("+n+"rad)")):t.style.removeProperty("transform")}else vars.patchedTrueCyclius&&t.style.removeProperty("transform")}else vars.patchedTrueCyclius=!1}),t}return __extends(t,e),t}(RoutineCollection),DrawRoutine=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Routine),drawRoutine=new DrawRoutine(new DrawRoutineCollection()),ResetRoutineCollection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resetSaveData=new RoutineFunction(function(){return saveData.reset()}),t.resetScroll=new RoutineFunction(function(){for(var e in Game.Objects){var t=Game.Objects[e];t.scrollOffX&&(t.scrollOffX=0)}}),t}return __extends(t,e),t}(RoutineCollection),ResetRoutine=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Routine),resetRoutine=new ResetRoutine(new ResetRoutineCollection()),_Routines=Object.freeze({__proto__:null,logicRoutine:logicRoutine,drawRoutine:drawRoutine,resetRoutine:resetRoutine}),grandmaProperties={Farm:{building:Game.Objects.Farm,frequency:1,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(40*(Math.random()-.5)),y:e.y+_Mathfloor(10*(Math.random()-.5))+5,z:e.y+.1,id:t,pic:"farmerGrandma.png",frame:-1,grandma:!0}}},Mine:{building:Game.Objects.Mine,frequency:1,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(25*(Math.random()-.5))+10,y:e.y+_Mathfloor(5*(Math.random()-.4))+2,z:e.y+.1,id:t,pic:"minerGrandma.png",frame:-1,grandma:!0}}},Factory:{building:Game.Objects.Factory,frequency:1,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(50*(Math.random()-.5)),y:e.y,z:e.y+.1,id:t,pic:"workerGrandma.png",frame:-1,grandma:!0}}},Bank:{building:Game.Objects.Bank,frequency:_MathE/2,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(40*(Math.random()-.5)),y:e.y+_Mathfloor(4*(Math.random()-.5)),z:e.y+.1,id:t,pic:"bankGrandma.png",frame:-1,grandma:!0}}},Temple:{building:Game.Objects.Temple,frequency:1,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(25*(Math.random()-.5)),y:e.y+_Mathfloor(4*(Math.random()-.5)),z:e.y+.1,id:t,pic:"templeGrandma.png",frame:-1,grandma:!0}}},"Wizard tower":{building:Game.Objects["Wizard tower"],frequency:3,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(35*(Math.random()-.5))+20,y:_Mathfloor(12*(Math.random()-.5))+60,z:e.y+50,id:t,pic:"witchGrandma.png",frame:-1,grandma:!0}}},Shipment:{building:Game.Objects.Shipment,frequency:.5,drawGrandma:function(e,t){var a="0.1"==(t-e.id).toFixed(1)?-1:1,s=e.x+_Mathfloor(5*(Math.random()*a))+15*a,i=e.y+_Mathfloor(20*Math.random())+-1*(15*a);return{x:s,y:i,z:i+t%1,id:t,pic:"cosmicGrandma.png",frame:-1,grandma:!0}}},"Alchemy lab":{building:Game.Objects["Alchemy lab"],frequency:1,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(45*(Math.random()-.5)),y:e.y+_Mathfloor(4*(Math.random()-.5)),z:e.y+.1,id:t,pic:"transmutedGrandma.png",frame:-1,grandma:!0}}},Portal:{building:Game.Objects.Portal,frequency:_MathPI/2,drawGrandma:function(e,t){var a=_Mathfloor(70*Math.random());return{x:e.x+_Mathfloor(35*(Math.random()-.5)),y:a,z:999+a+t,id:t,pic:"alteredGrandma.png",frame:-1,grandma:!0}}},"Time machine":{building:Game.Objects["Time machine"],frequency:1,drawGrandma:function(e,t){return loadCustomAsset("https://gamrguy.github.io/OmniscientCookies/img/timemachine_front.png"),[{x:e.x-5,y:e.y-2,z:999+e.id,id:t,pic:"grandmasGrandma.png",frame:-1,grandma:!0},{x:e.x,y:e.y,z:1e3+e.id,id:t+.01,pic:"https://gamrguy.github.io/OmniscientCookies/img/timemachine_front.png",frame:-1}]}},"Antimatter condenser":{building:Game.Objects["Antimatter condenser"],frequency:1,drawGrandma:function(e,t){return{x:e.x,y:e.y-6,z:999+e.id,id:t,pic:"antiGrandma.png",frame:-1,grandma:!0}}},Prism:{building:Game.Objects.Prism,frequency:1,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(45*(Math.random()-.5)),y:e.y+_Mathfloor(8*(Math.random()-.5))+8,z:e.y+.1,id:t,pic:"rainbowGrandma.png",frame:-1,grandma:!0}}},Chancemaker:{building:Game.Objects.Chancemaker,frequency:2,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(50*(Math.random()-.5)),y:70,z:777+e.id,id:t,pic:"luckyGrandma.png",frame:-1,grandma:!0}}},"Fractal engine":{building:Game.Objects["Fractal engine"],frequency:_MathPI/4,drawGrandma:function(e,t){var a=Math.sign,s=(t-e.id).toFixed(1);this.prevX&&"0.1"!=s&&s!=this.prevID||(this.prevX=0,this.prevY=0);var i=e.x+_Mathfloor(35*(Math.random()-.5)),n=_Mathfloor(70*Math.random());return this.prevX&&30>_Mathabs(i-this.prevX)&&(i+=30*a(i-e.x)),this.prevY&&30>_Mathabs(n-this.prevY)&&(n+=30*a(e.y-n)),this.prevX=i,this.prevY=n,this.prevID=s,{x:i,y:n,z:999+n+t,id:t,pic:"metaGrandma.png",frame:-1,grandma:!0}}},Idleverse:{building:Game.Objects.Idleverse,frequency:_MathPI/1.5,drawGrandma:function(e,t){return{x:e.x+_Mathfloor(15*(Math.random()-.5)),y:e.y+_Mathfloor(15*(Math.random()-.5))-25,z:e.y+1,id:t,pic:"alternateGrandma.png",frame:-1,grandma:!0}}}},_GrandmaSupport=Object.freeze({__proto__:null,registerSupport:registerSupport,tryDrawGrandmas:tryDrawGrandmas,grandmaProperties:grandmaProperties}),name$1="Omniscient Cookies",version$1=version,Util=_Util,Config=_Config,Patches=_Patches,Logger=_Logger,Routines=_Routines,GrandmaSupport=_GrandmaSupport,vars$1=vars,settings$1=settings,saveData$1=saveData,grandmaDesc=[choose(["nice grandmas","hard-working grandmas","old ladies"]),"farmers","miners","workers",choose(["bankers","brokers","financial advisors","accountants"]),"priestesses","witches",choose(["aliens","bounty hunters","spice traders","kessel runners"]),"alchemists",choose(["elder abominations","flesh piles","doughy beings"]),choose(["time policemas","nice old lady's nice old ladies"]),"antimatter constructs","living rainbows","leprechauns","Cyriak wannabes",choose(["NaNnies","[Error: cookie is not defined]s","['g','r','a','n']s"]),choose(["spaghetti bakers","pancake flippers","not-cookie productionists","pastry panhandlers"])],buildingChoice=choose(Game.ObjectsById);buildingChoice==Game.Objects.Cursor&&(buildingChoice=Game.Objects.Grandma);var numGrandmas=0;numGrandmas=buildingChoice==Game.Objects.Grandma?Game.Objects.Grandma.amount:Util.getNumSynergyGrandmas(buildingChoice);var grandmaMessage="Your "+numGrandmas+" "+grandmaDesc[buildingChoice.id-1]+" missed you!";(0==buildingChoice.amount||0>=numGrandmas)&&(grandmaMessage=". . . but nobody came");var OmniCookiesExport,startupMessages=["And then he said,<br>'Let there be cookies'","Some dude called "+choose(["theGameMaster1234","RobotLucca","gamrguy","theMineMaster2","DeadlyFez"])+" made this","That ascend meter was getting antsy",grandmaMessage,"The cookies have eyes.<br>Watch yourself out there","Over the river and through the cookies","Thank you for choosing the Typescript edition of Omniscient Cookies!<br>(No warranties, no refunds)","What do Omniscient Cookies taste like?<br>Study reveals a flavor 'somewhere between amateur Javascript and messy programming'","Also try <a href=\"https://github.com/staticvariablejames/SpicedCookies/\" target=\"_blank\">Spiced Cookies</a>!","You stared into the cookie,<br>and the cookie stared back","Check out the <a href=\"https://github.com/gamrguy/OmniscientCookies/\" target=\"_blank\">GitHub page</a>!"],mod={init:function(){Patches.smoothBuildings.apply(),Patches.scrollingBuildings.apply(),Patches.buffTooltips.apply(),Patches.updateMenu.apply(),Patches.tooltipWobble.apply(),Patches.cycliusGains.apply(),Patches.stockInfo.apply(),Patches.fancyBuildings.apply(),Patches.fancyCursors.apply(),Patches.fancyWrinklers.apply(),Patches.skruuiaRebalance.apply(),Patches.dangerousStocks.apply(),Patches.cycliusInfo.apply(),Game.registerHook("logic",function(){return Routines.logicRoutine.run()}),Game.registerHook("draw",function(){return Routines.drawRoutine.run()}),Game.registerHook("reset",function(){return Routines.resetRoutine.run()}),Game.Notify("Loaded "+name$1+" "+version$1,"<q>"+choose(startupMessages)+"</q>",[10,31],6)},save:function(){return JSON.stringify({settings:settings$1.save(),saveData:saveData$1.save()})},load:function(e){var t=JSON.parse(e);settings$1.load(t.settings),saveData$1.load(t.saveData),Patches.buySellBulk.apply(),Patches.scrollbarStyle.toggle(settings$1.autoScrollbar),Patches.buildingTooltips.toggle(settings$1.betterBuildingTooltips),Patches.miscGrandmaFixes.toggle(settings$1.betterGrandmas),Patches.cursedFingerTweaks.toggle(settings$1.cursedFinger),Patches.displaySeasonUnlock.toggle(settings$1.displaySeasons),Patches.statsUpgradeCategories.toggle(settings$1.separateTechs||settings$1.separateSeasons),Patches.optiCookies.toggle(settings$1.optiCookies),Patches.dangerousBrokers.toggle(settings$1.dangerousBrokers)}},OmniCookies=Object.freeze({__proto__:null,name:name$1,version:version$1,Util:Util,Config:Config,Patches:Patches,Logger:Logger,Routines:Routines,GrandmaSupport:GrandmaSupport,vars:vars$1,settings:settings$1,saveData:saveData$1,mod:mod});window.OmniCookies?(Logger.warn("Mod loaded twice???"),OmniCookiesExport=window.OmniCookies):(Game.registerMod(name$1,mod),OmniCookiesExport=OmniCookies,window.OmniCookies=OmniCookies);var OmniCookiesExport$1=OmniCookiesExport;return OmniCookiesExport$1});
//# sourceMappingURL=main.js.map
